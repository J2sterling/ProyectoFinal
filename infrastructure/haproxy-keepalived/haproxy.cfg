global
    daemon
    log 127.0.0.1:514 local0 notice
    stats socket /var/run/haproxy/admin.sock mode 660 level admin
    stats timeout 30s

defaults
    log global
    mode http
    option httplog
    option dontlognull
    timeout connect 5000ms
    timeout client 50000ms
    timeout server 50000ms
    option forwardfor
    option http-server-close

# Frontend for web traffic
frontend http_front
    bind *:80
    stats uri /haproxy?stats
    stats realm Haproxy\ Statistics
    stats auth admin:datadog123

    # Define backends
    acl is_frontend path_beg / || path_beg /static
    acl is_backend path_beg /api

    use_backend frontend_servers if is_frontend
    use_backend backend_servers if is_backend
    default_backend frontend_servers

# Backend for frontend services
backend frontend_servers
    balance roundrobin
    option httpchk
    server frontend1 frontend:3000 check inter 10s fall 3 rise 2

# Backend for backend services
backend backend_servers
    balance roundrobin
    option httpchk
    server backend1 backend:3001 check inter 10s fall 3 rise 2
    server backend2 backend:3001 check inter 10s fall 3 rise 2

# Statistics for DataDog
listen stats
    bind *:8080
    mode http
    stats enable
    stats uri /stats
    stats refresh 10s
    stats auth admin:datadog123
